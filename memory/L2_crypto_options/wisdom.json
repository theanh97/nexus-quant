{
  "_project": "crypto_options",
  "_version": "2.0.0",
  "_updated": "2026-02-20",
  "_description": "Accumulated wisdom + validated rules for Crypto Options VRP (Deribit)",
  "_status": "Phase 2 — VRP VALIDATED (avg=1.520, min=1.273, 5yr WF)",

  "LIVE_OBSERVATIONS": {
    "_note": "Real Deribit data collected 2026-02-20 via live collector",
    "BTC_2026_02_20": {
      "price": 67664,
      "iv_atm_pct": 47.8,
      "skew_25d_pct": 21.0,
      "term_spread": 0.008,
      "note": "BTC IV=47.8% (lower than synthetic 76%). Skew high at 21% (puts expensive vs calls). Slight contango (+0.8%)."
    },
    "ETH_2026_02_20": {
      "price": 1962,
      "iv_atm_pct": 64.9,
      "skew_25d_pct": 14.1,
      "term_spread": -0.022,
      "note": "ETH IV=64.9%. Slight backwardation (-2.2%) = mild stress signal."
    },
    "CALIBRATION_NOTE": "Synthetic model uses long_run=0.75 (75%). Actual BTC IV was 47.8% on this date. Historical range 30-150%. Model is within reasonable range but may overestimate in calm periods.",
    "COLLECTION_STATUS": "Data collector active. Need 720 rows (30d) for Skew MR + Term Structure validation."
  },

  "RULES": {
    "_note": "Hard rules learned from painful debugging. ALWAYS check before touching VRP strategy.",
    "R1_exit_threshold": {
      "rule": "exit_z_threshold = -2.0, NOT -1.5",
      "why": "z=-1.5 fires ~15% of bars → overtrading → costs destroy alpha. z=-2.0 fires ~2% → true extreme spikes only.",
      "impact": "Avg Sharpe: -1.5 gives 0.878, -2.0 gives 1.520. Delta = +0.642 Sharpe!",
      "status": "VALIDATED"
    },
    "R2_rebalance_frequency": {
      "rule": "rebalance_freq = 5 (weekly for 1d bars), NEVER 1 (daily)",
      "why": "Daily rebalancing: avg Sharpe = -0.534 (negative!). Weekly: avg = 1.520.",
      "why_detailed": "VRP is a carry trade. Signal barely changes day-to-day. Daily turnover costs exceed VRP income.",
      "status": "VALIDATED"
    },
    "R3_pnl_formula": {
      "rule": "Use quadratic: PnL_bar = 0.5 * (IV² - RV_bar_ann²) * dt",
      "formula": "rv_bar_ann = abs(log_ret) * sqrt(bars_per_year); pnl = 0.5*(iv**2 - rv_bar_ann**2)*dt",
      "why": "Linear formula (SCALE * (IV_daily - |log_ret|)) is wrong — gives avg Sharpe -0.311.",
      "theory": "From delta-hedged straddle: Theta = 0.5*IV²*dt, Gamma cost = 0.5*RV²*dt, Net = 0.5*(IV²-RV²)*dt",
      "no_scale_factor": "NO arbitrary SCALE constant. Proper finance formula needs no calibration.",
      "status": "VALIDATED"
    },
    "R4_signal_direction": {
      "rule": "Always short vol as base position. Short vol = NEGATIVE weight in weights dict.",
      "formula": "bar_pnl += (-w) * vrp_pnl  [(-w) > 0 when w < 0 = short]",
      "why": "VRP is PERSISTENT — IV > RV in ~80% of all bars. A carry trade, not a timing signal.",
      "status": "VALIDATED"
    },
    "R5_cross_sectional_zscore": {
      "rule": "NEVER use cross-sectional z-score for VRP signal. Use time-series per-symbol z-score.",
      "why": "With 2 symbols (BTC+ETH), cross-sectional z-score always makes one long and one short. Even though BOTH have positive VRP, you'd go long ETH (wrong direction) → loses money.",
      "correct": "_get_vrp_zscore() computes z-score vs symbol's own 60d history.",
      "status": "VALIDATED — learned from debugging session"
    },
    "R6_strategy_naming": {
      "rule": "VRP strategy name must contain 'vrp' or 'variance' for options_engine to use gamma/theta PnL.",
      "code": "is_vrp = 'vrp' in strategy_name.lower() or 'variance' in strategy_name.lower()",
      "default_class_name": "VariancePremiumStrategy (name='crypto_vrp')",
      "status": "ARCHITECTURAL"
    }
  },

  "market_insights": {
    "variance_risk_premium": {
      "summary": "Crypto IV consistently overstates future realized vol by 5-15 vol points (VRP). VALIDATED carry edge.",
      "evidence": "5-yr WF: all years positive, min=1.273, avg=1.520. Best in low-vol 2023 (1.944).",
      "validated": true,
      "phase": "Phase 2 — WF validated 2021-2025"
    },
    "vrp_regime_dependence": {
      "summary": "VRP strategy BEST in low-vol years (2023: Sharpe=1.944), GOOD in high-vol (2022: 1.446).",
      "insight": "Both crash (2022) and calm (2023) work! VRP is robust across regimes because IV ALWAYS overstates RV on average.",
      "correlation_with_perps": "Estimated 0.2-0.35. Both lose on extreme crash days (same gamma losses). But perps also profits from trends while VRP only collects theta."
    },
    "skew": {
      "summary": "25-delta put skew signal FAILS walk-forward on daily bars with synthetic data.",
      "avg_sharpe_synthetic": 0.297,
      "min_sharpe_synthetic": -0.474,
      "reason": "Delta-equivalent proxy insufficient. Skew signal doesn't translate to underlying price direction.",
      "fix": "Need real Deribit options chain data. Collect live data → re-validate after 60+ days.",
      "validated": false
    },
    "term_structure": {
      "summary": "Term spread signal FAILS walk-forward. avg=-0.456, min=-3.101.",
      "reason": "Synthetic term_spread from AR(1) doesn't have real mean-reversion dynamics.",
      "fix": "Same as skew — need real IV data from Deribit.",
      "validated": false
    }
  },

  "implementation_notes": {
    "data_strategy": "Synthetic IV (AR(1) calibrated to Deribit): VRP_mean=BTC8%/ETH10%, VRP_std=4%/5%. Store live data from Deribit for real validation.",
    "backtest_approach": "Gamma/theta model: 0.5*(IV²-RV²)*dt. Weekly rebalance. No delta exposure.",
    "cost_model": "Deribit taker: 5 bps on underlying notional. DERIBIT_REALISTIC preset.",
    "universe": "BTC + ETH only (Deribit). Options liquidity thin beyond top 2."
  },

  "validated_hypotheses": [
    "VRP is a persistent, robust carry signal in crypto options (5yr WF validated)",
    "Carry-style (always short vol) outperforms timing-based (exit on signal threshold)",
    "Weekly rebalancing optimal — daily rebalance destroys alpha via transaction costs",
    "Gamma/theta PnL model (quadratic) correct — no arbitrary scale factors needed",
    "Exit threshold z=-2.0 dramatically better than z=-1.5 for cost management"
  ],

  "failed_hypotheses": [
    "Skew mean-reversion on daily bars with synthetic data — FAILS WF",
    "Term structure signal on daily bars with synthetic data — FAILS WF",
    "Cross-sectional z-score for VRP signal — WRONG approach (both symbols can be short)",
    "Daily rebalancing (freq=1) — transaction costs exceed VRP income",
    "Linear PnL formula with SCALE factor — wrong direction and magnitude"
  ],

  "open_questions": [
    "Can vol-scaling (higher leverage when VRP z-score very high) improve MIN Sharpe?",
    "Real Deribit IV data: would Skew MR validate with 60+ days of real data?",
    "What's the actual correlation between VRP and perps strategies? Estimated 0.2-0.35.",
    "Can we use BTC vol regime (high/low) to dynamically allocate between perps and options?",
    "Is there a 5th signal for crypto_perps from options market (skew as regime filter)?"
  ],

  "next_research": [
    "Vol-scaling VRP: lever up at high VRP (z > 1.0), normal at moderate VRP — Phase 138",
    "Portfolio: perps (60%) + options (40%) dynamic allocation — Phase 138",
    "Live Deribit data collection daemon — background service — Phase 138",
    "Skew as REGIME signal for perps (not direct alpha) — Phase 139"
  ]
}
